# NMAP

Nmap包含四项基本功能：

- 主机发现（Host Discovery）

- 端口扫描（Port Scanning）

- 版本侦测（Version Detection）

- 操作系统侦测（Operating System Detection）



# NMAP常用命令



## 1、参数

```bash
-sL                                   List Scan.简单的列表扫描，仅仅是显示,扫描的IP数目,不会进行任何扫描
-sn                                   ping扫描,用于发现主机列表
-Pn                                   不进行ping扫描，在线处理所有所有主机不检测主机存活。
-PS/PA/PU/PY[portlist]                TCP SYN Ping/TCP ACK Ping/UDP Ping发现
-PE/PP/PM                             使用ICMP echo, timestamp and netmask 请求包发现主机
-PO[prococol list]                    使用IP协议包探测对方主机是否开启
-n/-R                                 不对IP进行域名反向解析/为所有的IP都进行域名的反响解析
--dns-servers <serv1[,serv2],...>     指定DNS服务器
--traceroute              			  追踪每个路由节点

-sV             开放版本探测,可以直接使用-A同时打开操作系统探测和版本探
-O              启用操作系统检测,-A来同时启用操作系统检测和版本检测
```



```bash
 -p 可以指定要扫描的端口
 -v 获取详细的输出
 -n 禁用DNS反向解析
 
 -sL (列表扫描)
 -sP (Ping扫描)
 -P0 (无ping)
 -PR (ARP Ping)
 -n (不用域名解析)
 
 -sS (TCP SYN扫描),半开扫描，执行速度快，在没有入侵防火墙的网络上可以快速扫描数千个端口
 -sT (TCP connect()扫描,这种扫描会给对方留下扫描日志，动静太大)
 -sU (UDP扫描)

 -iL (从列表中输入)
从文件中导入主机名(ip地址或域名，以下相同) 格式如上所述，可以CIDR，文件内容必须以换行符隔开。

 –exclude <host1[，host2][，host3]，…> (排除主机/网络)排除不是目标的主机
 –excludefile (排除文件中的列表) 排除不是目标的主机的列表
```

- 防火墙/IDS躲避和哄骗

```shell
-f; --mtu value                 指定使用分片、指定数据包的MTU.
-D decoy1,decoy2,ME             使用诱饵隐蔽扫描
-S IP-ADDRESS                   源地址欺骗
-e interface                    使用指定的接口
-g/ --source-port PROTNUM       使用指定源端口
--proxies url1,[url2],...       使用HTTP或者SOCKS4的代理

--data-length NUM               填充随机数据让数据包长度达到NUM
--ip-options OPTIONS            使用指定的IP选项来发送数据包
--ttl VALUE                     设置IP time-to-live域
--spoof-mac ADDR/PREFIX/VEBDOR  MAC地址伪装
--badsum                        使用错误的checksum来发送数据包

```



## 2、命令实例

- 快速扫描targetip

    >nmap -v -n 192.168.0.103

- 精细扫描，可以查看更详细的信息，如包含服务版本，操作系统类型，甚至还有traceroute..

    > nmap -T4 -A -v 192.168.0.103

- 进行秘密SYN扫描，对象为主机Saznme所在的“C类”网段 的255台主机。同时尝试确定每台工作主机的操作系统类型。因为进行SYN扫描 和操作系统检测，这个扫描需要有根权限。

    > nmap -sS -O scanme.nmap.org/24

- 进行主机列举和TCP扫描，对象为B类188.116网段中255个8位子网。这 个测试用于确定系统是否运行了sshd、DNS、imapd或4564端口。如果这些端口 打开，将使用版本检测来确定哪种应用在运行。

    > nmap -sV -p 22，53，110，143，4564 198.116.0-255.1-127

- 随机选择100000台主机扫描是否运行Web服务器(80端口)。由起始阶段 发送探测报文来确定主机是否工作非常浪费时间，而且只需探测主机的一个端口，因 此使用-P0禁止对主机列表。

    > nmap -v -iR 100000 -P0 -p 80

- 扫描4096个IP地址，查找Web服务器(不ping)，将结果以Grep和XML格式保存。

    > nmap -P0 -p80 -oX logs/pb-port80scan.xml -oG logs/pb-port80scan.gnmap 216.163.128.20/20

- 输出扫描报告

  > nmap -sP -oN d:\result.txt x.x.x.x #-oN：将扫描结果保存在txt文本中输出
  > nmap -sP -oX d:\result.xml x.x.x.x #-oX：将扫描结果保存在xml文本中输出，需要使用浏览器打开

# Zenmap的使用

Zenmap提供了10个模板，分别是：

    Intense scan ：nmap -T4 -A -v 192.168.0.0/24
        该选项扫描速度最快，可以检测操作系统和版本
    Intense scan plus UDP ：nmap -sS -sU -T4 -A -v 192.168.0.0/24
        UDP扫描
    Intense scan,all TCP ports ：nmap -p 1-65536 -T4 -A -v 192.168.0.0/24
        对目标所有端口进行扫描，速度比较慢。
    Intense scan,no ping ：nmap -T4 -A -v -Pn 192.168.0.0/24
        不进行PING扫描
    Ping scan ：nmap -sn 192.168.0.0/24
        PING扫描，速度快，容易被防火墙屏蔽，导致无扫描结果
    Quick scan ：nmap -T4 -F 192.168.0.0/24
        快速的扫描
    Quick scan plus ：nmap -sV -T4 -O -F --version-light 192.168.0.0/24
        快速加强模式
    Quick traceroute ：nmap -sn --traceroute 192.168.0.0/24
        路由追踪
    Regular scan nmap 192.168.0.0/24
        普通扫描
    Slow comprehensive scan : nmap -sS -sU -T4 -A -v -PE -PP -PS80,443,-PA3389,PU40125 -PY -g 53 --script (default or discovery and safe) 192.168.0.0/24
        慢速全面扫描
